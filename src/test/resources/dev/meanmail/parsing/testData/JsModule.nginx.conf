http {
    js_import http.js;

    js_set $foo     http.foo;
    js_set $summary http.summary;
    js_set $hash    http.hash;

    resolver 10.0.0.1;

    server {
        listen 8000;

        location / {
            add_header X-Foo    $foo;
            js_content http.baz;
        }

        location = /summary {
            return 200 $summary;
        }

        location = /hello {
            js_content http.hello;
        }

        # since 0.7.0
        location = /fetch {
            js_content                   http.fetch;
            js_fetch_trusted_certificate /path/to/ISRG_Root_X1.pem;
        }

        # since 0.7.0
        location = /crypto {
            add_header Hash $hash;
            return     200;
        }

        location @periodics {
            # to be run at 1 minute intervals in worker process 0
            js_periodic main.handler interval=60s;

            # to be run at 1 minute intervals in all worker processes
            js_periodic main.handler interval=60s worker_affinity=all;

            # to be run at 1 minute intervals in worker processes 1 and 3
            js_periodic main.handler interval=60s worker_affinity=0101;

            resolver                     10.0.0.1;
            js_fetch_trusted_certificate /path/to/ISRG_Root_X1.pem;
        }
    }

    js_include http.js;
    server {
        location /version {
            js_content version;
        }
    }

    js_preload_object map.json;
}
