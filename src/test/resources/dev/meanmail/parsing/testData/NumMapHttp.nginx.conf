# ngx_http_num_map_module example
# https://nginx.org/en/docs/http/ngx_http_num_map_module.html

http {
    # Map status codes to categories
    num_map $status $status_category {
        default "unknown";
        100-199 "informational";
        200-299 "success";
        300-399 "redirection";
        400-499 "client_error";
        500-599 "server_error";
    }

    # Map response time to performance tier
    num_map $request_time $performance_tier {
        default  "slow";
        0-100    "fast";
        101-500  "normal";
        501-1000 "acceptable";
    }

    # Map bytes sent to size category
    num_map $bytes_sent $response_size {
        default        "huge";
        0-1024         "tiny";
        1025-10240     "small";
        10241-102400   "medium";
        102401-1048576 "large";
    }

    # Using volatile for non-cacheable variable
    num_map $upstream_response_time $upstream_tier {
        volatile;
        default  "timeout";
        0-50     "excellent";
        51-200   "good";
        201-1000 "fair";
    }

    server {
        listen 80;

        location / {
            # Use mapped variables in logs
            add_header X-Status-Category  $status_category;
            add_header X-Performance-Tier $performance_tier;
            add_header X-Response-Size    $response_size;

            return 200 "OK";
        }
    }
}
