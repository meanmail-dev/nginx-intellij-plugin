server {
    server_rewrite_by_lua_block {
                     ngx.ctx.a = "server_rewrite_by_lua_block in http"
    }

    location /lua {
        content_by_lua_block {
                                     ngx.say(ngx.ctx.a)
                                     ngx.log(ngx.INFO, ngx.ctx.a)
        }
    }
}

server {
    server_rewrite_by_lua_block {
                 ngx.log(ngx.INFO, "is_subrequest:", ngx.is_subrequest)
    }

    location /lua {
        content_by_lua_block {
                                 local res = ngx.location.capture("/sub")
                                 ngx.print(res.body)
        }
    }

    location /sub {
        content_by_lua_block {
                                 ngx.say("OK")
        }
    }
}
