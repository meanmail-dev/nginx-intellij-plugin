location /foo {
    set $diff ''; # we have to predefine the $diff variable here

    set_by_lua_block $sum {



                     local a = 32
                     local b = 56

                     ngx.var.diff = a - b  -- write to $diff directly
                     return a + b          -- return the $sum value normally



    }

    echo "sum = $sum, diff = $diff";
}

set $foo 32;
set_by_lua_block $bar {


 return tonumber(ngx.var.foo) + 1


}
set $baz "bar: $bar";  # $baz == "bar: 33"
