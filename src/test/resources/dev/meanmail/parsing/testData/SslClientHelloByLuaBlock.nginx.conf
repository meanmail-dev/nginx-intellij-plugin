server {
    listen              443               ssl;
    server_name         test.com;
    ssl_certificate     /path/to/cert.crt;
    ssl_certificate_key /path/to/key.key;
    ssl_client_hello_by_lua_block {
                     local ssl_clt = require "ngx.ssl.clienthello"
                     local host, err = ssl_clt.get_client_hello_server_name()
                     if host == "test.com" then
                         ssl_clt.set_protocols({"TLSv1", "TLSv1.1"})
         elseif host == "test2.com" then
             ssl_clt.set_protocols({"TLSv1.2", "TLSv1.3"})
         elseif not host then
             ngx.log(ngx.ERR, "failed to get the SNI name: ", err)
             ngx.exit(ngx.ERROR)
         else
             ngx.log(ngx.ERR, "unknown SNI name: ", host)
             ngx.exit(ngx.ERROR)
         end
    }
}
server {
    listen              443               ssl;
    server_name         test2.com;
    ssl_certificate     /path/to/cert.crt;
    ssl_certificate_key /path/to/key.key;
}
